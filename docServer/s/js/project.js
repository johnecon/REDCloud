/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */

/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

var saveAs=saveAs||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,a=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,i=function(a){var n=t.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(n)},r=e.webkitRequestFileSystem,s=e.requestFileSystem||r||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",d=0,m=500,u=function(t){var n=function(){"string"==typeof t?a().revokeObjectURL(t):t.remove()};e.chrome?n():setTimeout(n,m)},p=function(e,t,a){t=[].concat(t);for(var n=t.length;n--;){var o=e["on"+t[n]];if("function"==typeof o)try{o.call(e,a||e)}catch(i){l(i)}}},g=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e},y=function(t,l){t=g(t);var m,y,h,f=this,b=t.type,T=!1,E=function(){p(f,"writestart progress write writeend".split(" "))},w=function(){if((T||!m)&&(m=a().createObjectURL(t)),y)y.location.href=m;else{var n=e.open(m,"_blank");void 0==n&&"undefined"!=typeof safari&&(e.location.href=m)}f.readyState=f.DONE,E(),u(m)},D=function(e){return function(){return f.readyState!==f.DONE?e.apply(this,arguments):void 0}},v={create:!0,exclusive:!1};return f.readyState=f.INIT,l||(l="download"),o?(m=a().createObjectURL(t),n.href=m,n.download=l,i(n),f.readyState=f.DONE,E(),void u(m)):(e.chrome&&b&&b!==c&&(h=t.slice||t.webkitSlice,t=h.call(t,0,t.size,c),T=!0),r&&"download"!==l&&(l+=".download"),(b===c||r)&&(y=e),s?(d+=t.size,void s(e.TEMPORARY,d,D(function(e){e.root.getDirectory("saved",v,D(function(e){var a=function(){e.getFile(l,v,D(function(e){e.createWriter(D(function(a){a.onwriteend=function(t){y.location.href=e.toURL(),f.readyState=f.DONE,p(f,"writeend",t),u(e)},a.onerror=function(){var e=a.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){a["on"+e]=f["on"+e]}),a.write(t),f.abort=function(){a.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),w)}),w)};e.getFile(l,{create:!1},D(function(e){e.remove(),a()}),D(function(e){e.code===e.NOT_FOUND_ERR?a():w()}))}),w)}),w)):void w())},h=y.prototype,f=function(e,t){return new y(e,t)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t){return navigator.msSaveOrOpenBlob(g(e),t)}:(h.abort=function(){var e=this;e.readyState=e.DONE,p(e,"abort")},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,f)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);if("undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define("file-saver.min",[],function(){return saveAs}),"function"!=typeof Blob||"undefined"==typeof URL)if("function"==typeof Blob&&"undefined"!=typeof webkitURL)var URL=webkitURL;else var Blob=function(e){var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},n=function(e,t,a){this.data=e,this.size=e.length,this.type=t,this.encoding=a},o=a.prototype,i=n.prototype,r=e.FileReaderSync,s=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,d=e.URL||e.webkitURL||e,m=d.createObjectURL,u=d.revokeObjectURL,p=d,g=e.btoa,y=e.atob,h=!1,f=function(e){h=!e},b=e.ArrayBuffer,T=e.Uint8Array;for(n.fake=i.fake=!0;c--;)s.prototype[l[c]]=c+1;try{T&&f.apply(0,new T(1))}catch(E){}return d.createObjectURL||(p=e.URL={}),p.createObjectURL=function(e){var t,a=e.type;return null===a&&(a="application/octet-stream"),e instanceof n?(t="data:"+a,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):g?t+";base64,"+g(e.data):t+","+encodeURIComponent(e.data)):m?m.call(d,e):void 0},p.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&u&&u.call(d,e)},o.append=function(e){var a=this.data;if(T&&(e instanceof b||e instanceof T))if(h)a.push(String.fromCharCode.apply(String,new T(e)));else for(var o="",i=new T(e),l=0,c=i.length;c>l;l++)o+=String.fromCharCode(i[l]);else if("Blob"===t(e)||"File"===t(e)){if(!r)throw new s("NOT_READABLE_ERR");var d=new r;a.push(d.readAsBinaryString(e))}else e instanceof n?"base64"===e.encoding&&y?a.push(y(e.data)):"URI"===e.encoding?a.push(decodeURIComponent(e.data)):"raw"===e.encoding&&a.push(e.data):("string"!=typeof e&&(e+=""),a.push(unescape(encodeURIComponent(e))))},o.getBlob=function(e){return arguments.length||(e=null),new n(this.data.join(""),e,"raw")},o.toString=function(){return"[object BlobBuilder]"},i.slice=function(e,t,a){var o=arguments.length;return 3>o&&(a=null),new n(this.data.slice(e,o>1?t:this.data.length),a,this.encoding)},i.toString=function(){return"[object Blob]"},a}(e);return function(e,a){var n=a?a.type||"":"",o=new t;if(e)for(var i=0,r=e.length;r>i;i++)o.append(e[i]);return o.getBlob(n)}}(self);define("Blob",function(){}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=d;l&&t.length&&(d=[],e(t))}function a(){l||(l=!0,r&&clearInterval(r),t())}function n(e){return l?e(c):d.push(e),n}var o,i,r,s="undefined"!=typeof window&&window.document,l=!s,c=s?document:null,d=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(window.attachEvent){window.attachEvent("onload",a),i=document.createElement("div");try{o=null===window.frameElement}catch(m){}i.doScroll&&o&&window.external&&(r=setInterval(function(){try{i.doScroll(),a()}catch(e){}},30))}"complete"===document.readyState&&a()}return n.version="2.0.1",n.load=function(e,t,a,o){o.isBuild?a(null):n(a)},n}),define("modals",["bootbox.min","domReady!"],function(e){function t(){return myDiagram.selection.first().part.data}var a=function(e,t){return newLocArr=e.split(" "),newLoc=newLocArr[0]+" "+(parseInt(newLocArr[1])+t).toString(),newLoc},n=500,o=function(){t();e.confirm("Are you sure you want to delete this node?",function(e){e&&(myDiagram.startTransaction("deleteNode"),myDiagram.model.setDataProperty(myDiagram.selection.first().part.data,"delete",!0),"Edge"!=t().category&&"Sync"!=t().category&&myDiagram.selection.first().linksConnected.each(function(e){myDiagram.model.setDataProperty(e.part.data,"delete",!0)}),myDiagram.commitTransaction("deleteNode"))}).on("hide.bs.modal",function(){myDiagram.toolManager.contextMenuTool.stopTool()})},i=function(){e.confirm("Are you sure you want to synchronize these nodes?",function(e){if(e){myDiagram.startTransaction("synchronize");var t=_.chain(myDiagram.selection.toArray()).sortBy(function(e){return e.location.x}).value();_.reduce(t,function(e,t){var a={category:"Sync",from:e.part.data.key,to:t.part.data.key};return myDiagram.model.addLinkData(a),t}),myDiagram.commitTransaction("synchronize"),s.reset()}}).on("hide.bs.modal",function(){myDiagram.toolManager.contextMenuTool.stopTool()})},r=function(){t();myDiagram.startTransaction("undoDeleteNode"),myDiagram.model.setDataProperty(myDiagram.selection.first().part.data,"delete",!1),myDiagram.commitTransaction("undoDeleteNode"),myDiagram.toolManager.contextMenuTool.stopTool()},s={reset:function(){this.robot=new Robot(myDiagram),this.objects=[],this.synced={};var e=this;myDiagram.links.each(function(t){if("Sync"!=t.category||t.part.data["delete"]){if(t.part.data&&!t.part.data["delete"]){var a=t.part.data.from,n=myDiagram.findNodeForKey(a),o=t.part.data.to,i=myDiagram.findNodeForKey(o);n.part.data.category.startsWith(ACTION_CATEGORY_PREFIX)&&"Object"==i.part.data.category&&(e.synced[a]=void 0==e.synced[a]?[]:e.synced[a],e.synced[a].push(i))}}else{var a=t.part.data.from,o=t.part.data.to,n=myDiagram.findNodeForKey(t.part.data.from),i=myDiagram.findNodeForKey(t.part.data.to);e.synced[a]=void 0==e.synced[a]?[]:e.synced[a],e.synced[o]=void 0==e.synced[o]?[]:e.synced[o],i.part.data.tense==FUTURE_TENSE,e.synced[a].push(i),n.part.data.tense==FUTURE_TENSE,e.synced[o].push(n)}})},object:null,objects:[],objectsAlreadyShown:[],robot:null,synced:null,next:function(){return this.object=this.objects.pop(),this.object},current:function(){return this.object},updateObjects:function(e){var t=this;_(this.synced[e]).each(function(e){-1==t.objectsAlreadyShown.indexOf(e)&&t.objects.push(e)})},run:function(){this.next();var e=this.current();this.objects.length>=0&&(e&&e.part.data.tense==FUTURE_TENSE&&"Object"==e.part.data.category?(this.robot.mouseDown(e.location.x,e.location.y,0,{right:!0}),this.robot.mouseUp(e.location.x,e.location.y,1,{right:!0}),setTimeout(function(){$("#realizeObject").click()},n)):e&&e.part.data.tense==FUTURE_TENSE&&e.part.data.category.startsWith(ACTION_CATEGORY_PREFIX)?(this.robot.mouseDown(e.location.x,e.location.y,0,{right:!0}),this.robot.mouseUp(e.location.x,e.location.y,1,{right:!0}),setTimeout(function(){$("#realizeAction").click()},n)):e&&(e.part.data.category.startsWith(ACTION_CATEGORY_PREFIX)||"Object"==e.part.data.category)?(this.objectsAlreadyShown.push(e),this.updateObjects(e.part.data.key),this.run()):this.reset())}};return require(["jquery.fileDownload","colorpicker"],function(){function n(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,n=e.getFullYear();return 10>t&&(t="0"+t),10>a&&(a="0"+a),n+"-"+a+"-"+t}function l(e){myDiagram.toolManager.contextMenuTool.stopTool(),e.hide().appendTo("body")}function c(e){e.show().validate().resetForm(),e.find(".form-group").each(function(){jQuery(this).removeClass("has-error").removeClass("has-success")})}function d(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")}function m(e){e.addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success"),e.closest(".control-label").remove()}function u(e){myDiagram.startTransaction("createObjectNode");var o,i,r={name:e.find('[name="name"]').val(),description:e.find('[name="description"]').val(),tense:e.find('[name="tense"]').val(),"public":e.find('[name="public"]').prop("checked")?"YES":"NO",start:e.find('[name="start"]').prop("checked")?"YES":"NO"},s=t();_(jQuery(e).find('[name^="resource"]')).each(function(e){o=e.value.split(RESOURCE_PK_NAME_SEPARATOR)[0],i=e.value.split(RESOURCE_PK_NAME_SEPARATOR)[1]});var l="YES"!=r.start?0:200,c={key:getKey(),name:r.name,description:r.description,category:"Object","public":r["public"],tense:null==i?FUTURE_TENSE:r.tense,strokeDashArray:r.tense==FUTURE_TENSE||null==i?[5,10]:null,fill:null!=i&&r.tense==PAST_TENSE?GREY_BLUE:r.tense==PRESENT_TENSE?"lightblue":"white",resourcePk:i,resourceName:o,group:s.key,createdBy:current_user.username,loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+(l+myDiagram.toolManager.contextMenuTool.mouseDownPoint.y).toString(),date:n()};if("YES"==r.start){var d={key:getKey(),category:"Start",group:s.key,createdBy:current_user.username,loc:a(c.loc,-200),date:n()},m={key:getKey(),tense:FUTURE_TENSE,category:"Action-In",name:"Creating "+r.name,description:"",operation_type:OPERATION_TYPE_INTERNAL,group:s.key,fill:"white",strokeDashArray:[5,10],createdBy:current_user.username,loc:a(c.loc,-100),date:n()},u={category:"Edge",from:d.key,to:m.key},p={category:"Edge",from:m.key,to:c.key};myDiagram.model.addNodeData(m),myDiagram.model.addNodeData(d),myDiagram.model.addNodeData(c),myDiagram.model.addLinkData(u),myDiagram.model.addLinkData(p)}else myDiagram.model.addNodeData(c);myDiagram.commitTransaction("createObjectNode")}function p(e){myDiagramGroupKeys=[],myDiagram.nodes.each(function(e){"SwimLane"==e.part.data.category&&myDiagramGroupKeys.push(e.part.data.key)}),_(w).each(function(t){if(t.pk==e.find("option:selected").val()){if(myDiagram.startTransaction("importTemplate"),myTemplateGroupKeys=[],_(t.graph_elements).each(function(e){e.pk=null,["SwimLane"].indexOf(e.category)>-1&&myTemplateGroupKeys.push(e.key)}),D=Math.abs(myTemplateGroupKeys.length-myDiagramGroupKeys.length),myDiagramGroupKeys.length<myTemplateGroupKeys.length)for(a=0;D>a;a++)myDiagramGroupKeys.push(myDiagramGroupKeys[myDiagramGroupKeys.length-1]);else if(myTemplateGroupKeys.length<myDiagramGroupKeys.length)for(a=0;D>a;a++)myTemplateGroupKeys.push(myTemplateGroupKeys[myTemplateGroupKeys.length-1]);for(var a=0;a<myTemplateGroupKeys.length;a+=1)S[myTemplateGroupKeys[a]]=myDiagramGroupKeys[a];_(t.graph_elements).each(function(e){e.pk=null,e.group=S[e.group],-1==["Pool","SwimLane","Sync","Edge"].indexOf(e.category)&&myDiagram.model.addNodeData(e)}),_(t.graph_elements).each(function(e){["Sync","Edge"].indexOf(e.category)>-1&&(e.from=e.src,e.to=e.tgt,delete e.tgt,delete e.src,myDiagram.model.addLinkData(e))}),myDiagram.layout.invalidateLayout(),myDiagram.findTopLevelGroups().each(function(e){"Pool"===e.category&&e.layout.invalidateLayout()}),myDiagram.layoutDiagram(),myDiagram.commitTransaction("importTemplate")}})}function g(e){myDiagram.startTransaction("importObject");var a={resource:e.find('[name="resource"]').val(),display:e.find("option:selected").text(),name:e.find('[name="name"]').val()},o=t(),i=_(v).filter(function(e){return e.pk==a.resource})[0],r="",s="",l={key:getKey(),category:ACTION_CATEGORY_PREFIX+OPERATION_TYPE_IMPORT,tense:FUTURE_TENSE,operation_type:OPERATION_TYPE_IMPORT,strokeDashArray:[5,10],fill:"white",name:"Importing "+a.display,description:"",group:o.key,createdBy:current_user.username,date:n(),loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+myDiagram.toolManager.contextMenuTool.mouseDownPoint.y.toString()};if(myDiagram.model.addNodeData(l),i&&"Folder"==i.type){var c=-50;_(_(v).filter(function(e){return e.pk==a.resource})[0].items).each(function(e){r=e.name.split("_")[0],s=""!=a.name?a.name+"-":"";var t={key:getKey(),name:s+r,category:"Object","public":"NO",tense:FUTURE_TENSE,strokeDashArray:[5,10],fill:"white",resourcePk:e?e.pk:null,resourceName:e?r:null,group:o.key,createdBy:current_user.username,loc:(myDiagram.toolManager.contextMenuTool.mouseDownPoint.x+c).toString()+" "+(myDiagram.toolManager.contextMenuTool.mouseDownPoint.y+100).toString(),date:n()};c+=100;var i={category:"Edge",from:l.key,to:t.key};myDiagram.model.addNodeData(t),myDiagram.model.addLinkData(i)})}else{r=i?i.name.split("_")[0]:"",s=r?a.name+"-"+r:a.name;var d={key:getKey(),name:s,category:"Object","public":"NO",strokeDashArray:[5,10],fill:"white",tense:FUTURE_TENSE,resourcePk:i?i.pk:null,resourceName:""==r?null:r,group:o.key,createdBy:current_user.username,loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+(myDiagram.toolManager.contextMenuTool.mouseDownPoint.y+100).toString(),date:n()},m={category:"Edge",from:l.key,to:d.key};myDiagram.model.addNodeData(d),myDiagram.model.addLinkData(m)}myDiagram.commitTransaction("importObject")}function y(e){myDiagram.startTransaction("editObjectNode");var a=t(),o={change:e.find('[name="change"]').val(),description:e.find('[name="description"]').val(),name:e.find('[name="name"]').val(),tense:e.find('[name="tense"]').val(),"public":e.find('[name="public"]').prop("checked")?"YES":"NO"};o.resourcePk=""==a.resourcePk?null:a.resourcePk,o.resourceName=""==a.resourceName?null:a.resourceName,_(jQuery(e).find('[name^="resource"]')).each(function(e){o.resourcePk=e.value.split(RESOURCE_PK_NAME_SEPARATOR)[0],o.resourceName=e.value.split(RESOURCE_PK_NAME_SEPARATOR)[1]}),myDiagram.model.setDataProperty(a,"fill","white"),o.tense==PRESENT_TENSE&&a.tense==FUTURE_TENSE&&(myDiagram.model.setDataProperty(a,"realized_by",current_user.username),myDiagram.model.setDataProperty(a,"toLinkable",!1),myDiagram.model.setDataProperty(a,"date_realized",n())),(o.tense==FUTURE_TENSE||null!=o.resourcePk)&&(myDiagram.model.setDataProperty(a,"tense",o.tense),myDiagram.model.setDataProperty(a,"strokeDashArray",o.tense==FUTURE_TENSE?[5,10]:null),myDiagram.model.setDataProperty(a,"fill",o.tense==PRESENT_TENSE?"lightblue":"white"),o.tense==PAST_TENSE&&myDiagram.model.setDataProperty(a,"fill",GREY_BLUE)),myDiagram.model.setDataProperty(a,"name",o.name),myDiagram.model.setDataProperty(a,"description",o.description),myDiagram.model.setDataProperty(a,"resourcePk",o.resourcePk),myDiagram.model.setDataProperty(a,"resourceName",o.resourceName),myDiagram.model.setDataProperty(a,"public",o["public"]),myDiagram.commitTransaction("editObjectNode")}function h(e){myDiagram.startTransaction("editActionNode");var a=t(),o=e.find('[name="name"]').val(),i=e.find('[name="description"]').val(),r=e.find('[name="tense"]').val(),s=e.find('[name="operation_type"]').val(),l=null,c=null;if("SwimLane"==a.category){r==PRESENT_TENSE&&(l=current_user.username,c=n());var d={key:getKey(),category:ACTION_CATEGORY_PREFIX+s,tense:r,operation_type:s,name:o,description:i,strokeDashArray:r==FUTURE_TENSE?[5,10]:null,fill:r==PRESENT_TENSE?"lightyellow":"white",group:a.key,createdBy:current_user.username,date:n(),loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+myDiagram.toolManager.contextMenuTool.mouseDownPoint.y.toString()};myDiagram.model.addNodeData(d)}else myDiagram.model.setDataProperty(a,"fill","white"),r==PAST_TENSE?myDiagram.model.setDataProperty(a,"fill",GREY_YELLOW):r==PRESENT_TENSE&&(myDiagram.model.setDataProperty(a,"fill","lightyellow"),myDiagram.model.setDataProperty(a,"toLinkable",!1),a.tense==FUTURE_TENSE&&(myDiagram.model.setDataProperty(a,"realized_by",current_user.username),myDiagram.model.setDataProperty(a,"date_realized",n()))),myDiagram.model.setCategoryForNodeData(a,ACTION_CATEGORY_PREFIX+s),myDiagram.model.setDataProperty(a,"name",e.find('[name="name"]').val()),myDiagram.model.setDataProperty(a,"description",e.find('[name="description"]').val()),myDiagram.model.setDataProperty(a,"tense",r),myDiagram.model.setDataProperty(a,"operation_type",s),myDiagram.model.setDataProperty(a,"strokeDashArray",r==FUTURE_TENSE?[5,10]:null);myDiagram.commitTransaction("editActionNode")}function f(){myDiagram.startTransaction("editSwimLane");var e=t();myDiagram.model.setDataProperty(e,"color",jQuery("#editSwimLaneModal").find('[name="color"]').val()),myDiagram.commitTransaction("editSwimLane")}function b(e){myDiagram.startTransaction("editComment");var a=t();myDiagram.model.setDataProperty(a,"name",e.find('[name="name"]').val()),myDiagram.commitTransaction("editComment")}function T(e){myDiagram.startTransaction("comment");var a=t(),o={name:e.find('[name="name"]').val()},i={key:getKey(),category:"Comment",name:o.name,group:a.key,createdBy:current_user.username,loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+myDiagram.toolManager.contextMenuTool.mouseDownPoint.y.toString(),date:n()};myDiagram.model.addNodeData(i),myDiagram.commitTransaction("comment")}function E(e){myDiagram.startTransaction("exportObjects");var t={name:e.find('[name="name"]').val(),description:e.find('[name="description"]').val()},o=[],i="",r=0,s=[];myDiagram.selection.each(function(e){r==myDiagram.selection.count-1&&(i=i.substring(0,i.length-2),myDiagram.selection.count>1&&(i+=" and ")),s.push(e.part.data.key),o.push(e.part.data.resourcePk),i+=e.part.data.name,r<myDiagram.selection.count-1&&(i+=", "),r++});var l=myDiagram.selection.first();myDiagram.selection.each(function(e){e.part.data.loc.split(" ")[1]>l.part.data.loc.split(" ")[1]&&(l=e)}),jQuery.ajax({type:"POST",url:"resources/export",contentType:"application/json",data:JSON.stringify({name:t.name,pks:o}),success:function(e){for(var o={key:getKey(),name:t.name,category:"Object","public":"YES",tense:FUTURE_TENSE,resourceName:e.resourceName,resourcePk:e.resourcePk,group:l.part.data.group,createdBy:current_user.username,date:n(),strokeDashArray:[5,10],loc:a(l.part.data.loc,200+10*Math.random())},r={key:getKey(),category:ACTION_CATEGORY_PREFIX+OPERATION_TYPE_EXPORT,tense:FUTURE_TENSE,operation_type:OPERATION_TYPE_EXPORT,name:"Exporting "+i+" into "+t.name,description:t.description,group:l.part.data.group,createdBy:current_user.username,strokeDashArray:[5,10],date:n(),loc:a(l.part.data.loc,100+10*Math.random())},c=0;c<s.length;c++)myDiagram.model.addLinkData({category:"Edge",from:s[c],to:r.key});myDiagram.model.addNodeData(r),i=i.substring(0,i.length-2);var d={category:"Edge",from:r.key,to:o.key};myDiagram.model.addNodeData(o),myDiagram.model.addNodeData(r),myDiagram.model.addLinkData(d),myDiagram.commitTransaction("exportObjects")},error:function(e){console.log(e)},dataType:"json"})}var w,D,v=(users.length,[]),k=function(e,t){for(property in t)myDiagram.model.setDataProperty(e,property,t[property]);myDiagram.model.setDataProperty(e,"is_modified",!0)},S={},x=jQuery("#action-name-input"),P=jQuery("#editActionModal");P.validate({rules:{name:{required:!0,minlength:2}},errorClass:"control-label",highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(e){e.addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success"),e.closest(".control-label").remove()},messages:{name:{required:"Please enter a change title",minlength:"A change title must consist of at least 2 characters"}},submitHandler:function(){h(P),e.hideAll()}});var N=P.find('[name="tense"]');jQuery("#editAction").on("click",function(){var a=t();N.find("option").remove().end(),N.append(a.tense==FUTURE_TENSE?$("<option>",{value:FUTURE_TENSE,text:"Future"}):a.tense==PRESENT_TENSE?$("<option>",{value:PRESENT_TENSE,text:"Present"}):a.tense==PAST_TENSE?$("<option>",{value:PAST_TENSE,text:"Past"}):$("<option>",{value:FUTURE_TENSE,text:"Future"})),P.find('[name="name"]').val(a.name).prop("disabled",a.tense==PAST_TENSE).end().find('[name="description"]').val(a.description).prop("disabled",a.tense==PAST_TENSE).end().find('[name="operation_type"]').val(a.operation_type).prop("disabled",a.tense==PAST_TENSE).end().find('[name="tense"]').val(a.tense).prop("disabled",!0).end(),e.dialog({title:"Edit Action Node",message:P,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(P)}).on("hide.bs.modal",function(){l(P)}).modal("show"),x.focus()}),jQuery("#createAction").on("click",function(){t();N.find("option").remove().end(),N.append($("<option>",{value:FUTURE_TENSE,text:"Future"})),P.find('[name="name"]').val("").prop("disabled",!1).end().find('[name="description"]').val("").prop("disabled",!1).end().find('[name="operation_type"]').val(OPERATION_TYPE_INTERNAL).prop("disabled",!1).end().find('[name="tense"]').val(FUTURE_TENSE).prop("disabled",!0).end(),e.dialog({title:"Create Action Node",message:P,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(P)}).on("hide.bs.modal",function(){l(P)}).modal("show"),x.focus()});var j=jQuery("#realize-action-name-input"),M=jQuery("#realizeActionModal");M.validate({rules:{name:{required:!0,minlength:2}},errorClass:"control-label",highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(e){e.addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success"),e.closest(".control-label").remove()},messages:{name:{required:"Please enter a change title",minlength:"A change title must consist of at least 2 characters"}},submitHandler:function(){h(M),e.hideAll(),s.updateObjects(t().key),s.objectsAlreadyShown.push(myDiagram.findNodeForKey(t().key)),s.run()}}),jQuery("#realizeAction").on("click",function(){var a=t();M.find('[name="name"]').val(a.name).prop("disabled",!1).end().find('[name="description"]').val(a.description).end().find('[name="tense"]').val(PRESENT_TENSE).prop("disabled",!0).end().find('[name="operation_type"]').val(a.operation_type).prop("disabled",!0).end(),e.dialog({title:"Realize Action Node",message:M,show:!1,animate:!1,onEscape:function(){s.reset(),this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(M)}).on("hide.bs.modal",function(){l(M)}).modal("show"),j.focus()});var A=jQuery("#editSwimLaneModal"),C=A.find('[name="color"]');A.validate({rules:{color:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{color:{required:"Please pick a color"}},submitHandler:function(){f(C.val()),e.hideAll()}}),jQuery("#editSwimLane").on("click",function(){var a=t();C.val(a.color).end(),A.find('[name="name"]').val(a.name),e.dialog({title:"Edit User",message:A,show:!1,animate:!1,onEscape:function(){C.ColorPickerHide(),this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(A)}).on("hide.bs.modal",function(){l(A)}).modal("show")});var R=jQuery("#editObjectModal"),O=R.find('[name="tense"]'),B=jQuery("#edit-object-name-input");R.validate({rules:{name:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{name:{required:"Please enter a name"}},submitHandler:function(){y(R),e.hideAll()}}),jQuery("#editObject").on("click",function(){var a=t();O.find("option").remove().end(),O.append(a.tense==FUTURE_TENSE?$("<option>",{value:FUTURE_TENSE,text:"Future"}):a.tense==PRESENT_TENSE?$("<option>",{value:PRESENT_TENSE,text:"Present"}):a.tense==PAST_TENSE?$("<option>",{value:PAST_TENSE,text:"Past"}):$("<option>",{value:FUTURE_TENSE,text:"Future"}));var n=void 0!=a.resourceName?"<a>"+a.resourceName+"</a>":"";loadUploader(R.find(".file-uploader")[0]),R.find('[name="name"]').val(a.name).prop("disabled",a.tense==PAST_TENSE).end().find('[name="description"]').val(a.description).prop("disabled",a.tense==PAST_TENSE).end().find('[name="tense"]').val(a.tense).prop("disabled",!0).end().find('[class="file-name"]').html(n).end().find('[name="file"]').prop("disabled",a.tense==PAST_TENSE).end().find('[name="public"]').prop("checked","YES"==a["public"]).prop("disabled",a.tense==PAST_TENSE).end(),insertFileInput(R.find('[class="file-input"]'),"resource",void 0!=a.resourcePk?a.resourcePk+RESOURCE_PK_NAME_SEPARATOR+a.resourceName:""),e.dialog({title:"Edit Artifact",message:R,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(R)}).on("hide.bs.modal",function(){l(R)}).modal("show"),B.focus()});var L=jQuery("#comment-name-input"),F=jQuery("#commentModal");F.validate({rules:{name:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{name:{required:"Please enter a name"}},submitHandler:function(){T(F),e.hideAll()}}),jQuery("#comment").on("click",function(){t();F.find('[name="name"]').val("").end(),e.dialog({title:"Add Comment",message:F,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(F)}).on("hide.bs.modal",function(){l(F)}).modal("show"),L.focus()});var U=jQuery("#edit-comment-name-input"),I=jQuery("#editCommentModal");I.validate({rules:{name:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{name:{required:"Please enter a name"}},submitHandler:function(){b(I),e.hideAll()}}),jQuery("#editComment").on("click",function(){t();I.find('[name="name"]').val("").end(),e.dialog({title:"Edit Comment",message:I,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(I)}).on("hide.bs.modal",function(){l(I)}).modal("show"),U.focus()});var z=jQuery("#import-object-name-input"),Q=jQuery("#importObjectModal"),W=Q.find('[name="resource"]');Q.validate({rules:{name:{required:!0},resource:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{resource:{required:"Please pick a file"},name:{required:"Please enter a name"}},submitHandler:function(){g(Q),e.hideAll()}}),jQuery("#importObject").on("click",function(){W.find("option").remove().end().append('<option value="">-- Pick a Resource --</option>').val(""),jQuery.ajax({type:"GET",url:"/resources",contentType:"application/json",success:function(e){v=e.data,$.each(v,function(e,t){W.append($("<option>",{value:t.pk,text:t.name}))})},error:function(e){console.log(e)}}),Q.find('[name="name"]').val("").end(),e.dialog({title:"Import Artifact",message:Q,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(Q)}).on("hide.bs.modal",function(){l(Q)}).modal("show"),z.focus()});var G=jQuery("#importTemplateModal"),H=G.find('[name="template"]');G.validate({rules:{template:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{template:{required:"Please pick a template"}},submitHandler:function(){p(G),e.hideAll()}}),jQuery("#importTemplate").on("click",function(){H.find("option").remove().end().append('<option value="">-- Pick a Template --</option>').val(""),jQuery.ajax({type:"GET",url:"/templates",contentType:"application/json",success:function(e){w=e.data,$.each(w,function(e,t){H.append($("<option>",{value:t.pk,text:t.__str__}))})},error:function(e){console.log(e)}}),e.dialog({title:"Import Template",message:G,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(G)}).on("hide.bs.modal",function(){l(G)}).modal("show")});var Y=jQuery("#new-object-name-input"),K=jQuery("#createObjectModal");K.validate({rules:{name:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{name:{required:"Please enter a name"}},submitHandler:function(){u(K),e.hideAll()}}),jQuery("#createObject").on("click",function(){t();loadUploader(K.find(".file-uploader")[0]),K.find('[name="name"]').val("").end().find('[name="description"]').val("").end().find('[name="tense"]').val(FUTURE_TENSE).prop("disabled",!0).end().find('[name="public"]').prop("checked",!1).end(),e.dialog({title:"Create Artifact",message:K,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(K)}).on("hide.bs.modal",function(){l(K)}).modal("show"),Y.focus()});var q=jQuery("#realizeObjectModal"),X=q.find('[name="tense"]'),J=jQuery("#realize-object-name-input");q.validate({ignore:"",rules:{name:{required:!0}},errorClass:"control-label",highlight:d,success:m,messages:{name:{required:"Please enter a name"}},submitHandler:function(){y(q),e.hideAll(),s.updateObjects(t().key),s.objectsAlreadyShown.push(myDiagram.findNodeForKey(t().key)),s.run()}}),jQuery("#realizeObject").on("click",function(){var a=t();X.find("option").remove().end(),X.append($("<option>",{value:PRESENT_TENSE,text:"Present"})),X.val(a.tense);var n=void 0!=a.resourceName?"<a>"+a.resourceName+"</a>":"";loadUploader(q.find(".file-uploader")[0]),q.find('[name="name"]').val(a.name).end().find('[name="description"]').end().find('[name="tense"]').val(PRESENT_TENSE).prop("disabled",!0).end().find('[class="file-name"]').html(n).find('[name="public"]').prop("checked","YES"==a["public"]).end(),insertFileInput(q.find('[class="file-input"]'),"resource",void 0!=a.resourcePk?a.resourcePk+RESOURCE_PK_NAME_SEPARATOR+a.resourceName:""),e.dialog({title:"Realize Artifact",message:q,show:!1,animate:!1,onEscape:function(){s.reset(),this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(q)}).on("hide.bs.modal",function(){l(q)}).modal("show"),J.focus()});var V=function(){var a=t();e.confirm("Are you sure you want to archive this node?",function(e){if(e){myDiagram.startTransaction("archiveNode"),k(a,{fill:"Object"==a.category?GREY_BLUE:GREY_YELLOW,tense:PAST_TENSE,fromLinkable:!1,toLinkable:!1,strokeDashArray:null,editable:!1,textColor:"white"});var o=0;if(myDiagram.selection.first().linksConnected.each(function(e){e.part.data.to!=t().key&&o++}),0==o){var i={key:getKey(),category:"End",type:"E",group:a.group,createdBy:current_user.username,loc:myDiagram.toolManager.contextMenuTool.mouseDownPoint.x.toString()+" "+(100+myDiagram.toolManager.contextMenuTool.mouseDownPoint.y).toString(),date:n(),is_modified:!0};myDiagram.model.addNodeData(i),myDiagram.model.addLinkData({category:"Edge",from:a.key,to:i.key})}myDiagram.commitTransaction("archiveNode")}}).on("hide.bs.modal",function(){myDiagram.toolManager.contextMenuTool.stopTool()
})};jQuery("#archiveAction").on("click",V),jQuery("#archiveObject").on("click",V),jQuery("#deleteAction").on("click",o),jQuery("#deleteObject").on("click",o),jQuery("#deleteComment").on("click",o),jQuery("#synchronize").on("click",i),jQuery("#undoDeleteAction").on("click",r),jQuery("#undoDeleteObject").on("click",r),jQuery("#undoDeleteComment").on("click",r);{var Z=jQuery("#export-objects-name-input"),et=jQuery("#exportObjectsModal");et.find('[name="group"]')}et.validate({rules:{name:{required:!0,minlength:2}},errorClass:"control-label",highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},success:function(e){e.addClass("valid").closest(".form-group").removeClass("has-error").addClass("has-success"),e.closest(".control-label").remove()},messages:{name:{required:"Please enter a package title",minlength:"A package title must consist of at least 2 characters"}},submitHandler:function(){E(et),e.hideAll()}}),jQuery("#exportObjects").on("click",function(){et.find('[name="name"]').val("").end().find('[name="description"]').val("").end(),e.dialog({title:"Export Artifacts",message:et,show:!1,animate:!1,onEscape:function(){this.trigger("hide.bs.modal")}}).on("shown.bs.modal",function(){c(et)}).on("hide.bs.modal",function(){l(et)}).modal("show"),Z.focus()}),jQuery("#object-download").click(function(){if(myDiagram.currentTool instanceof go.ContextMenuTool){var e=t(),a="/resources/"+e.resourcePk+"/download";jQuery.fileDownload(a,{successCallback:function(e){console.log("You just got a file download dialog or ribbon for this URL :"+e)},failCallback:function(e,t){alert("Your file download has failed for this URL:"+t+"\r\nPlease contact the system administrator for more details")}}),myDiagram.currentTool.stopTool()}}),jQuery("#color_picker").ColorPicker({closeOnOutside:!0,onSubmit:function(e,t,a,n){jQuery(n).val("#"+t),jQuery(n).ColorPickerHide()},onBeforeShow:function(){jQuery(this).ColorPickerSetColor(this.value)},onShow:function(e){return jQuery(e).fadeIn(500),!1},onHide:function(e){return jQuery(e).fadeOut(500),!1},onChange:function(e,t){$("#color_picker div").css("backgroundColor","#"+t)}}).bind("keyup",function(){jQuery(this).ColorPickerSetColor(this.value)}),jQuery("#grid").change(function(){myDiagram.startTransaction("grid"),myDiagram.grid.visible=this.checked,myDiagram.commitTransaction("grid")}),jQuery("#snap").change(function(){this.checked?(myDiagram.toolManager.draggingTool.isGridSnapEnabled=!0,myDiagram.toolManager.resizingTool.isGridSnapEnabled=!0):(myDiagram.toolManager.draggingTool.isGridSnapEnabled=!1,myDiagram.toolManager.resizingTool.isGridSnapEnabled=!1)}),jQuery("#align-left").click(function(){myDiagram.commandHandler.alignLeft()}),jQuery("#align-right").click(function(){myDiagram.commandHandler.alignRight()}),jQuery("#selectAllNodes").click(function(){collection=[],myDiagram.nodes.each(function(e){e.part.data.group==t().key&&collection.push(e)}),myDiagram.clearSelection(),collection.length>0&&myDiagram.selectCollection(collection),myDiagram.toolManager.contextMenuTool.stopTool()})}),{deleteNode:o,objectRealizationManager:s,getLoc:a}}),define("project",["go","bootbox.min","main","file-saver.min","Blob","modals","fileuploader","underscore-min","jquery-ui.min","jquery.validate","additional-methods.min"],function(e,t,a,n,o,r){require(["DrawCommandHandler"],function(){function t(){var e="None";switch(myDiagram.selection.count){case 0:e="Diagram";break;case 1:e=myDiagram.selection.first().category;break;default:var t=myDiagram.selection.all(function(e){return"Object"==e.part.data.category});if(t&&myDiagram.selection.count>1){e="Objects";break}for(var a=myDiagram.selection.iterator;a.next();)if("Object"!=a.key.category&&!a.key.category.startsWith(ACTION_CATEGORY_PREFIX)||a.key.part.data.tense!=FUTURE_TENSE){if("Object"!=a.key.category){e="None";break}}else e="ActionsObjects"}return e}function o(e,t){t==k?a.notify(e,"error",5,function(){}):a.notify(e,"success",5,function(){})}function s(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,n=e.getFullYear();return 10>t&&(t="0"+t),10>a&&(a="0"+a),n+"-"+a+"-"+t}function l(){myDiagram.nodes.each(function(t){t instanceof e.Group&&"Pool"!==t.category&&(t.layout.isValidLayout=!1)}),myDiagram.layoutDiagram()}function c(){myDiagram.layout.invalidateLayout(),myDiagram.findTopLevelGroups().each(function(e){"Pool"===e.category&&e.layout.invalidateLayout()}),myDiagram.layoutDiagram()}function d(t){var a=D;return t.memberParts.each(function(t){if(t instanceof e.Group){var n=t.placeholder;if(null!==n){var o=n.actualBounds;a=Math.max(a,o.height)}}}),new e.Size(0/0,a)}function m(e){var t=u(e);if(e.isSubGraphExpanded){var a=e.placeholder;if(null!==a){var n=a.actualBounds;t.width=Math.max(t.width,n.width)}}var o=e.findObject("HEADER");return t.width=Math.max(t.width,o.actualBounds.width),t}function u(t){return t.isSubGraphExpanded?new e.Size(v,D):new e.Size(1,D)}function p(){e.ResizingTool.call(this)}function g(){e.GridLayout.call(this),this.cellSize=new e.Size(1,1),this.wrappingColumn=1/0,this.wrappingWidth=1/0,this.isRealtime=!1,this.alignment=e.GridLayout.Position,this.comparer=function(e,t){var a=e.location.x,n=t.location.x;return isNaN(a)||isNaN(n)?0:n>a?-1:a>n?1:0}}function y(e,t){var a="<div id='infoBox'>";void 0!=t.description&&""!=t.description&&null!=t.description&&(a+="<textarea disabled style='resize: none; overflow: hidden;' rows=4'>"+t.description.substring(0,100)+(t.description.length>100?"...":"")+"</textarea>"),a+="<div>"+t.createdBy+"</div><div >"+t.date+"</div></div>",P.innerHTML=a,P.style.left=e.x+40+"px",P.style.top=e.y-40+"px"}function h(){var e=document.getElementById("currentFile"),t=e.textContent.indexOf("*");myDiagram.isModified?(myDiagram.model.addChangedListener(function(e){["loc","name","tense","description","group","category","public","createdBy","width","height","points","from","to","resourcePk"].indexOf(e.propertyName)>-1&&e.object&&e.oldValue!=e.newValue&&myDiagram.model.setDataProperty(e.object,"is_modified",!0)}),0>t&&(e.textContent=e.textContent+"*")):t>=0&&(e.textContent=e.textContent.substr(0,t))}function f(){function a(){return[{layerName:"Background",background:"transparent",movable:!0,copyable:!1,avoidable:!1,minLocation:new e.Point(-1/0,0/0),maxLocation:new e.Point(1/0,0/0)},new e.Binding("location","loc",e.Point.parse).makeTwoWay(e.Point.stringify)]}function n(){return[new e.Binding("location","loc",e.Point.parse).makeTwoWay(e.Point.stringify),{locationSpot:e.Spot.Center,mouseEnter:function(t,a){b(a.part,!0),t.diagram instanceof e.Palette||(timer=setTimeout(function(){y(t.viewPoint,a.data)},1e3))},mouseLeave:function(t,a){b(a.part,!1),t.diagram instanceof e.Palette||("undefined"!=typeof timer&&clearTimeout(timer),P.innerHTML="")},click:function(t,a){b(a.part,!1),t.diagram instanceof e.Palette||("undefined"!=typeof timer&&clearTimeout(timer),P.innerHTML="")}}]}function i(t,a,n,o,i,r){return d(e.Shape,"Circle",{fill:"transparent",stroke:null,desiredSize:new e.Size(i,r),alignment:a,alignmentFocus:a,portId:t,fromSpot:a,toSpot:a,fromLinkable:n,toLinkable:o,cursor:"pointer"},new e.Binding("fromLinkable","fromLinkable").makeTwoWay(),new e.Binding("toLinkable","toLinkable").makeTwoWay())}function l(e){e.findExternalLinksConnected().each(function(e){e.visible=e.fromNode.isVisible()&&e.toNode.isVisible()})}console.log("INIT STARTED!!!!");var d=e.GraphObject.make;myDiagram=d(e.Diagram,"myDiagram",{initialContentAlignment:e.Spot.Center,commandHandler:new DrawCommandHandler,allowDrop:!0,resizingTool:new p,layout:d(g),mouseDragOver:function(t){t.diagram.selection.all(function(t){return t instanceof e.Group})||(t.diagram.currentCursor="not-allowed")},mouseDrop:function(t,a){if(!t.diagram.selection.all(function(t){return t instanceof e.Group})){var n=a.addMembers(a.diagram.selection,!0);n||a.diagram.currentTool.doCancel()}},"commandHandler.copiesGroupKey":!0,SelectionMoved:c,SelectionCopied:c,"animationManager.isEnabled":!1,"undoManager.isEnabled":!0}),myDiagram.addDiagramListener("Modified",h);var m=myDiagram.commandHandler;m.pasteSelection=function(){e.CommandHandler.prototype.pasteSelection.call(m),myDiagram.selection.each(function(e){myDiagram.model.setDataProperty(e.part.data,"loc",r.getLoc(e.part.data.loc,100)),myDiagram.model.setDataProperty(e.part.data,"pk",null),console.log("NULL!")})},myDiagram.groupTemplate=d(e.Group,"Vertical",a(),{contextMenu:d(e.Adornment),selectionObjectName:"SHAPE",resizable:!0,resizeObjectName:"SHAPE",computesBoundsAfterDrag:!0,computesBoundsIncludingLinks:!1,computesBoundsIncludingLocation:!0,mouseDrop:function(t,a){var n=a.addMembers(a.diagram.selection,!0);(!n||a instanceof e.Group&&a.diagram.selection.first()instanceof e.Group)&&a.diagram.currentTool.doCancel()},subGraphExpandedChanged:function(e){var t=e.resizeObject;e.diagram.undoManager.isUndoingRedoing||(e.isSubGraphExpanded?t.width=e._savedBreadth:(e._savedBreadth=t.width,t.width=0/0),l(e))}},new e.Binding("isSubGraphExpanded","expanded").makeTwoWay(),d(e.Panel,"Horizontal",{name:"HEADER",angle:0,alignment:e.Spot.Center},d(e.Panel,"Horizontal",new e.Binding("visible","isSubGraphExpanded").ofObject(),d(e.TextBlock,{font:"bold 13pt sans-serif",editable:!0,margin:new e.Margin(2,0,0,0)},new e.Binding("text","name").makeTwoWay())),d("SubGraphExpanderButton",{margin:5})),d(e.Panel,"Auto",d(e.Shape,"Rectangle",{name:"SHAPE",fill:"white"},new e.Binding("fill","color"),new e.Binding("width","width").makeTwoWay(),new e.Binding("height","height").makeTwoWay(),new e.Binding("desiredSize","size",e.Size.parse).makeTwoWay(e.Size.stringify)),d(e.Placeholder,{padding:12,alignment:e.Spot.TopLeft}),d(e.TextBlock,{name:"LABEL",font:"bold 13pt sans-serif",editable:!0,angle:90,alignment:e.Spot.TopLeft,margin:new e.Margin(4,0,0,2)},new e.Binding("visible","isSubGraphExpanded",function(e){return!e}).ofObject(),new e.Binding("text","name").makeTwoWay()))),myDiagram.groupTemplate.resizeAdornmentTemplate=d(e.Adornment,"Spot",d(e.Placeholder),d(e.Shape,{alignment:e.Spot.Bottom,desiredSize:new e.Size(50,7),fill:"lightblue",stroke:"dodgerblue",cursor:"row-resize"},new e.Binding("visible","",function(e){return e.adornedPart.isSubGraphExpanded}).ofObject()),d(e.Shape,{alignment:e.Spot.Right,desiredSize:new e.Size(7,50),fill:"lightblue",stroke:"dodgerblue",cursor:"col-resize"},new e.Binding("visible","",function(e){return e.adornedPart.isSubGraphExpanded}).ofObject())),myDiagram.groupTemplateMap.add("Pool",d(e.Group,"Auto",a(),{layout:d(g,{spacing:new e.Size(0,0)})},d(e.Shape,{fill:"white"},new e.Binding("fill","color")),d(e.Panel,"Table",{defaultRowSeparatorStroke:"black"},d(e.Panel,"Horizontal",{row:0,angle:0},d(e.TextBlock,{font:"bold 16pt sans-serif",editable:!0,margin:new e.Margin(2,0,0,0)},new e.Binding("text","name").makeTwoWay())),d(e.Placeholder,{row:1})))),myDiagram.nodeTemplateMap.add("Start",d(e.Node,"Spot",n(),d(e.Panel,"Auto",d(e.Shape,"Circle",{desiredSize:new e.Size(30,30),fill:"black",stroke:null})),i("L",e.Spot.Left,!0,!1,5,5),i("R",e.Spot.Right,!0,!1,5,5),i("B",e.Spot.Bottom,!0,!1,5,5))),myDiagram.nodeTemplateMap.add("End",d(e.Node,"Spot",n(),d(e.Panel,"Auto",d(e.Shape,"Circle",{desiredSize:new e.Size(30,30),fill:"white",strokeWidth:2,stroke:"black"}),d(e.Shape,"ThinX",{desiredSize:new e.Size(15,15),fill:"black",stroke:null})),i("T",e.Spot.Top,!1,!0,5,5),i("L",e.Spot.Left,!1,!0,5,5),i("R",e.Spot.Right,!1,!0,5,5))),myDiagram.nodeTemplateMap.add("Choice",d(e.Node,"Spot",n(),d(e.Panel,"Auto",d(e.Shape,"Decision",{desiredSize:new e.Size(30,30),fill:"white",strokeWidth:2,stroke:"black"})),i("T",e.Spot.Top,!1,!0,5,5),i("L",e.Spot.Left,!0,!0,5,5),i("R",e.Spot.Right,!0,!0,5,5),i("B",e.Spot.Bottom,!0,!1,5,5))),myDiagram.nodeTemplateMap.add("Action-In",d(e.Node,"Spot",n(),{resizable:!0,resizeObjectName:"INFO-SHAPE"},d(e.Panel,"Auto",d(e.Shape,"RoundedRectangle",{name:"INFO-SHAPE",minSize:new e.Size(70,40),fill:"white",strokeWidth:2,stroke:"black"},new e.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new e.Binding("fill","fill").makeTwoWay(),new e.Binding("width").makeTwoWay(),new e.Binding("height").makeTwoWay()),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.TextBlock,{font:"9pt Helvetica, Arial, sans-serif",editable:!0,wrap:e.TextBlock.WrapFit,isMultiline:!0},new e.Binding("text","name").makeTwoWay(),new e.Binding("stroke","textColor").makeTwoWay(),new e.Binding("editable","editable").makeTwoWay()),{contextMenu:d(e.Adornment)}),i("T",e.Spot.Top,!1,!0,10,10),i("L",e.Spot.Left,!0,!0,10,10),i("R",e.Spot.Right,!0,!0,10,10),i("B",e.Spot.Bottom,!0,!1,10,10))),myDiagram.nodeTemplateMap.add("Action-Im",d(e.Node,"Spot",n(),{resizable:!0,resizeObjectName:"INFO-SHAPE"},d(e.Panel,"Auto",d(e.Shape,{geometryString:"F M0 0 L100 0 L100 100 L0 100 L20 50 L0 0z",name:"INFO-SHAPE",minSize:new e.Size(70,40),fill:"white",strokeWidth:2,stroke:"black"},new e.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new e.Binding("fill","fill").makeTwoWay(),new e.Binding("width").makeTwoWay(),new e.Binding("height").makeTwoWay()),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.TextBlock,{font:"9pt Helvetica, Arial, sans-serif",editable:!0,wrap:e.TextBlock.WrapFit,isMultiline:!0},new e.Binding("stroke","textColor").makeTwoWay(),new e.Binding("editable","editable").makeTwoWay(),new e.Binding("text","name").makeTwoWay()),{contextMenu:d(e.Adornment)}),i("T",e.Spot.Top,!1,!0,10,10),i("L",e.Spot.Left,!0,!0,10,10),i("R",e.Spot.Right,!0,!0,10,10),i("B",e.Spot.Bottom,!0,!1,10,10))),myDiagram.nodeTemplateMap.add("Action-Ex",d(e.Node,"Spot",n(),{resizable:!0,resizeObjectName:"INFO-SHAPE"},d(e.Panel,"Auto",d(e.Shape,{geometryString:"F M0 0 L100 0 L130 50 L100 100 L0 100 L0 0z",name:"INFO-SHAPE",minSize:new e.Size(70,40),fill:"white",strokeWidth:2,stroke:"black"},new e.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new e.Binding("fill","fill").makeTwoWay(),new e.Binding("width").makeTwoWay(),new e.Binding("height").makeTwoWay()),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.TextBlock,{font:"9pt Helvetica, Arial, sans-serif",editable:!0,wrap:e.TextBlock.WrapFit,isMultiline:!0},new e.Binding("stroke","textColor").makeTwoWay(),new e.Binding("editable","editable").makeTwoWay(),new e.Binding("text","name").makeTwoWay()),{contextMenu:d(e.Adornment)}),i("T",e.Spot.Top,!1,!0,10,10),i("L",e.Spot.Left,!0,!0,10,10),i("R",e.Spot.Right,!0,!0,10,10),i("B",e.Spot.Bottom,!0,!1,10,10))),myDiagram.nodeTemplateMap.add("Object",d(e.Node,"Spot",n(),{resizable:!0,resizeObjectName:"INFO-SHAPE"},d(e.Panel,"Auto",d(e.Shape,"File",{name:"INFO-SHAPE",minSize:new e.Size(50,60),fill:"white",strokeWidth:2,stroke:"black"},new e.Binding("strokeDashArray","strokeDashArray").makeTwoWay(),new e.Binding("fill","fill").makeTwoWay(),new e.Binding("width").makeTwoWay(),new e.Binding("height").makeTwoWay()),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.TextBlock,{font:"9pt Helvetica, Arial, sans-serif",editable:!0,wrap:e.TextBlock.WrapFit,margin:2,width:80,wrap:e.TextBlock.WrapFit,textAlign:"center",isMultiline:!0,stroke:"black"},new e.Binding("text","name").makeTwoWay(),new e.Binding("editable","editable").makeTwoWay(),new e.Binding("stroke","textColor").makeTwoWay()),{contextMenu:d(e.Adornment)}),i("R",e.Spot.Right,!1,!0,10,10),i("L",e.Spot.Left,!0,!0,10,10),i("T",e.Spot.Top,!0,!0,10,10),i("B",e.Spot.Bottom,!0,!1,10,10))),myDiagram.nodeTemplateMap.add("Fork",d(e.Node,"Auto",n(),d(e.Shape,"Rectangle",{desiredSize:new e.Size(30,10),fill:"black"}),i("R",e.Spot.Right,!0,!0,5,5),i("L",e.Spot.Left,!0,!0,5,5),i("T",e.Spot.Top,!0,!0,5,5),i("B",e.Spot.Bottom,!0,!0,5,5))),myDiagram.nodeTemplateMap.add("Comment",d(e.Node,"Auto",n(),{resizable:!0,resizeObjectName:"INFO-SHAPE"},d(e.Shape,"File",{name:"INFO-SHAPE",minSize:new e.Size(50,30),fill:"yellow",stroke:null},new e.Binding("width").makeTwoWay(),new e.Binding("height").makeTwoWay()),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.TextBlock,{margin:5,maxSize:new e.Size(200,0/0),wrap:e.TextBlock.WrapFit,textAlign:"center",editable:!0,font:"bold 12pt Helvetica, Arial, sans-serif",stroke:"#454545",isMultiline:!0},new e.Binding("text","name").makeTwoWay()),{contextMenu:d(e.Adornment)})),myDiagram.linkTemplateMap.add("",d(e.Link,{routing:e.Link.AvoidsNodes,curve:e.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,reshapable:!0},new e.Binding("points").makeTwoWay(),new e.Binding("relinkableFrom").makeTwoWay(),new e.Binding("relinkableTo").makeTwoWay(),d(e.Shape,{isPanelMain:!0,stroke:"black",strokeWidth:2}),d(e.Shape,{toArrow:"standard",stroke:null,fill:"black"}),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:2,segmentFraction:.5},new e.Binding("visible","visible").makeTwoWay(),d(e.Shape,"RoundedRectangle",{fill:"#F8F8F8",stroke:null}),d(e.TextBlock,"Yes",{textAlign:"center",font:"10pt Helvetica, Arial, sans-serif",stroke:"#333333",editable:!0},new e.Binding("text","name").makeTwoWay())))),myDiagram.linkTemplateMap.add("Sync",d(e.Link,{routing:e.Link.Normal,curve:e.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,reshapable:!0},new e.Binding("points").makeTwoWay(),d(e.Shape,{isPanelMain:!0,stroke:"blue",strokeDashArray:[5,10],strokeWidth:2}),d(e.Picture,{width:30,height:30,source:"/static/images/delete.png",visible:!1},new e.Binding("visible","delete").makeTwoWay()),d(e.Panel,"Auto",{visible:!1,name:"LABEL",segmentIndex:2,segmentFraction:.5},new e.Binding("visible","visible").makeTwoWay(),d(e.Shape,"RoundedRectangle",{fill:"#F8F8F8",stroke:null}),d(e.TextBlock,"Yes",{textAlign:"center",font:"10pt Helvetica, Arial, sans-serif",stroke:"#333333",editable:!0},new e.Binding("text","name").makeTwoWay())))),myDiagram.addDiagramListener("PartResized",function(e){e.diagram.selection.each(function(e){myDiagram.model.setDataProperty(e.part.data,"width",e.actualBounds.width),myDiagram.model.setDataProperty(e.part.data,"height",e.actualBounds.height)})}),myDiagram.addDiagramListener("LinkDrawn",function(e){e.diagram.selection.each(function(e){void 0==e.part.data.category&&myDiagram.model.setDataProperty(e.part.data,"category","Edge")})});new Robot(myDiagram);myDiagram.addDiagramListener("ObjectDoubleClicked",function(e){var t=e.diagram.selection.first();t.part.data.category.startsWith(ACTION_CATEGORY_PREFIX)?jQuery("#editAction").click():"Object"==t.part.data.category?jQuery("#editObject").click():"SwimLane"==t.part.data.category&&jQuery("#editSwimLane").click()}),myDiagram.addDiagramListener("SelectionDeleting",function(e){if(e.diagram.selection.count>1)return e.cancel=!0,void o("Cannot delete multiple selected parts",k);var t=e.diagram.selection.first();("Object"==t.part.data.category||t.part.data.category.startsWith(ACTION_CATEGORY_PREFIX))&&t.part.data.tense==FUTURE_TENSE||"Comment"==t.part.data.category?r.deleteNode():"Edge"==t.part.data.category||"Sync"==t.part.data.category?myDiagram.model.findNodeDataForKey(t.part.data.to).tense!=FUTURE_TENSE?(e.cancel=!0,o("Only flows leading to future tense nodes can be deleted",k)):r.deleteNode():o("Only nodes with future tense can be deleted",k),e.cancel=!0}),myDiagram.addDiagramListener("ExternalObjectsDropped",function(){var e=myDiagram.selection.first().part.data;e.category.startsWith(ACTION_CATEGORY_PREFIX)&&myDiagram.model.setDataProperty(e,"operation_type","In"),(e.category.startsWith(ACTION_CATEGORY_PREFIX)||"Object"==e.category)&&(myDiagram.model.setDataProperty(e,"tense",0),myDiagram.model.setDataProperty(e,"strokeDashArray",[5,10]))}),myPalette=d(e.Palette,"myPalette",{"animationManager.duration":300,nodeTemplateMap:myDiagram.nodeTemplateMap,model:new e.GraphLinksModel([{category:"Start",createdBy:current_user.username,date:s()},{category:ACTION_CATEGORY_PREFIX+OPERATION_TYPE_INTERNAL,createdBy:current_user.username,date:s()},{category:"Object",createdBy:current_user.username,date:s()},{category:"Choice",createdBy:current_user.username,date:s()},{category:"Fork",createdBy:current_user.username,date:s()},{category:"End",createdBy:current_user.username,date:s()},{category:"Comment",name:"",createdBy:current_user.username,date:s()}])});var u=document.getElementById("contextMenu");u.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},!1),u.addEventListener("blur",function(){cxMenu.stopTool()},!1);var f=myDiagram.toolManager.contextMenuTool;f.setUpMenus=function(){f.menus=[],this.objectEmptyCxMenu=this.objectEmptyCxMenu?this.objectEmptyCxMenu:jQuery(".object-empty-cxmenu"),this.objectNotExportedCxMenu=this.objectNotExportedCxMenu?this.objectNotExportedCxMenu:jQuery(".object-not-exported-cxmenu"),this.objectFutureCxMenu=this.objectFutureCxMenu?this.objectFutureCxMenu:jQuery(".object-future-cxmenu"),this.objectDeletedCxMenu=this.objectDeletedCxMenu?this.objectDeletedCxMenu:jQuery(".object-deleted-cxmenu"),this.objectPresentCxMenu=this.objectPresentCxMenu?this.objectPresentCxMenu:jQuery(".object-present-cxmenu"),this.actionFutureCxMenu=this.actionFutureCxMenu?this.actionFutureCxMenu:jQuery(".action-future-cxmenu"),this.actionDeletedCxMenu=this.actionDeletedCxMenu?this.actionDeletedCxMenu:jQuery(".action-deleted-cxmenu"),this.actionPresentCxMenu=this.actionPresentCxMenu?this.actionPresentCxMenu:jQuery(".action-present-cxmenu"),this.objectCxMenu=this.objectCxMenu?this.objectCxMenu:jQuery(".object-cxmenu"),this.objectsCxMenu=this.objectsCxMenu?this.objectsCxMenu:jQuery(".objects-cxmenu"),this.objectsActionsCxMenu=this.objectsActionsCxMenu?this.objectsActionsCxMenu:jQuery(".objects-actions-cxmenu"),this.swimLaneCxMenu=this.swimLaneCxMenu?this.swimLaneCxMenu:jQuery(".swimlane-cxmenu"),this.actionCxMenu=this.actionCxMenu?this.actionCxMenu:jQuery(".action-cxmenu"),this.graphCxMenu=this.graphCxMenu?this.graphCxMenu:jQuery(".graph-cxmenu"),this.commentCxMenu=this.commentCxMenu?this.commentCxMenu:jQuery(".comment-cxmenu"),this.commentDeletedCxMenu=this.commentDeletedCxMenu?this.commentDeletedCxMenu:jQuery(".comment-deleted-cxmenu"),this.menus.push(this.objectEmptyCxMenu),this.menus.push(this.objectNotExportedCxMenu),this.menus.push(this.objectFutureCxMenu),this.menus.push(this.objectDeletedCxMenu),this.menus.push(this.objectPresentCxMenu),this.menus.push(this.actionFutureCxMenu),this.menus.push(this.actionDeletedCxMenu),this.menus.push(this.actionPresentCxMenu),this.menus.push(this.objectCxMenu),this.menus.push(this.objectsCxMenu),this.menus.push(this.objectsActionsCxMenu),this.menus.push(this.swimLaneCxMenu),this.menus.push(this.actionCxMenu),this.menus.push(this.graphCxMenu),this.menus.push(this.commentCxMenu),this.menus.push(this.commentDeletedCxMenu)},f.display=function(e){if("None"!=e){u.style.display="block";var t=this.diagram.lastInput.viewPoint;u.style.left=t.x+10+"px",u.style.top=t.y+50+"px"}},f.hideContextMenu=function(){null!==this.currentContextMenu&&(u.style.display="none",this.currentContextMenu=null)},f.hideMenus=function(){_(this.menus).each(function(e){e.hide()})},f.showContextMenu=function(e){if(null!==this.diagram){var a=t();switch(e!==this.currentContextMenu&&this.hideContextMenu(),this.setUpMenus(),this.hideMenus(),a){case"Comment":1==this.diagram.selection.first().part.data["delete"]?this.commentDeletedCxMenu.show():this.commentCxMenu.show();break;case"Diagram":return void(this.currentContextMenu=e);case"Objects":var n=0,o=0;this.diagram.selection.each(function(e){e.part.data.tense!=FUTURE_TENSE&&o++}),this.objectsCxMenu.show(),0==o&&this.objectsActionsCxMenu.show(),0!=n&&0!=o&&(a="None");break;case"ActionsObjects":this.objectsActionsCxMenu.show();break;case"Object":void 0!=this.diagram.selection.first().part.data.resourceName?this.objectCxMenu.show():this.objectEmptyCxMenu.show(),"NO"==this.diagram.selection.first().part.data["public"]&&this.objectNotExportedCxMenu.show(),1==this.diagram.selection.first().part.data["delete"]&&this.objectDeletedCxMenu.show(),this.diagram.selection.first().part.data.tense==FUTURE_TENSE&&this.objectFutureCxMenu.show(),this.diagram.selection.first().part.data.tense==PRESENT_TENSE&&this.objectPresentCxMenu.show();break;case"SwimLane":this.swimLaneCxMenu.show();break;case ACTION_CATEGORY_PREFIX+OPERATION_TYPE_INTERNAL:case ACTION_CATEGORY_PREFIX+OPERATION_TYPE_IMPORT:case ACTION_CATEGORY_PREFIX+OPERATION_TYPE_EXPORT:this.actionCxMenu.show(),1==this.diagram.selection.first().part.data["delete"]?this.actionDeletedCxMenu.show():this.diagram.selection.first().part.data.tense==FUTURE_TENSE?this.actionFutureCxMenu.show():this.diagram.selection.first().part.data.tense==PRESENT_TENSE&&this.actionPresentCxMenu.show();break;case"Boundary":return void(this.currentContextMenu=e);case"None":}this.display(a),this.currentContextMenu=e}};var T=d(e.Overview,"myOverview",{observed:myDiagram,maxScale:.5,contentAlignment:e.Spot.Center});T.box.elt(0).stroke="dodgerblue",T.toolManager.standardMouseWheel=function(){var e=T.observed;if(null!==e){var t=e.commandHandler,a=T.lastInput,n=a.delta;0!==n&&(n>0?t.canIncreaseZoom():t.canDecreaseZoom())&&(n>0?t.increaseZoom():t.decreaseZoom(),a.bubbles=!1)}},w({message:!1}),console.log("INIT ENDED!!!!")}function b(e,t){var a=e.diagram;a&&!a.isReadOnly&&a.allowLink&&e.ports.each(function(e){e.stroke=t?"white":null,e.fill=t?"rgba(0,0,0,.3)":null})}function T(e){var t=JSON.stringify(myDiagram.model.toJson());jQuery.ajax({type:"POST",url:"update/",contentType:"application/json",data:t,success:function(){myDiagram.isModified=!1,h(),e.message&&o("Project successfully saved!",S),e.load&&w({message:!1})},error:function(){o("Project is NOT saved! An error occured.. Try to 'File->Export to JSON' your work and upload it later",k)}})}function E(e){var t=[];for(i=0;i<e.length;i++){var a={};a={from:e[i].src,to:e[i].tgt,pk:e[i].pk,points:JSON.parse(e[i].points),category:e[i].category,fromPort:e[i].fromPort,toPort:e[i].toPort},t.push(a)}return t}function w(t){jQuery.ajax({url:"load/",contentType:"application/json",success:function(a){myDiagram.isModified=!1,json={"class":"go.GraphLinksModel",linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort"},json.nodeDataArray=_(a.data.graphs[0].graph_elements).filter(function(e){return"Boundary"!=e.category&&"Edge"!=e.category&&"Sync"!=e.category}),json.linkDataArray=E(_(a.data.graphs[0].graph_elements).filter(function(e){return"Edge"==e.category||"Sync"==e.category})),myDiagram.model=e.Model.fromJson(json),t.message&&o("Project successfully loaded",S),l(),r.objectRealizationManager.reset()}})}var D=800,v=300,k=0,S=1,x=70;e.Diagram.inherit(p,e.ResizingTool),p.prototype.isLengthening=function(){return this.handle.alignment===e.Spot.Bottom},p.prototype.computeMinPoolSize=function(){var e=this.adornedObject.part,t=u(e);if(this.isLengthening()){var a=d(e.containingGroup);t.height=Math.max(t.height,a.height)}else{var a=m(e);t.width=Math.max(t.width,a.width),t.height=Math.max(t.height,a.height)}return t},p.prototype.resize=function(t){var a=this.adornedObject.part;this.isLengthening()?a.containingGroup.memberParts.each(function(a){if(a instanceof e.Group){var n=a.resizeObject;null!==n&&(n.height=t.height)}}):e.ResizingTool.prototype.resize.call(this,t),c()},e.Diagram.inherit(g,e.GridLayout),g.prototype.doLayout=function(t){var a=this.diagram;if(null!==a){a.startTransaction("PoolLayout");var n=this.group;if(null!==n&&"Pool"===n.category){var o=d(n);n.memberParts.each(function(t){if(t instanceof e.Group&&"Pool"!==t.category){var a=t.resizeObject;if(null!==a){var n=m(t);a.width=isNaN(a.width)?n.width:Math.max(a.width,n.width),a.height=isNaN(a.height)?o.height:Math.max(a.height,o.height);var i=t.resizeCellSize;!isNaN(a.width)&&!isNaN(i.width)&&i.width>0&&(a.width=Math.ceil(a.width/i.width)*i.width),!isNaN(a.height)&&!isNaN(i.height)&&i.height>0&&(a.height=Math.ceil(a.height/i.height)*i.height)}}})}e.GridLayout.prototype.doLayout.call(this,t),a.commitTransaction("PoolLayout")}};var P=document.getElementById("infoBoxHolder");jQuery("#load-file").on("change",function(t){reader=new FileReader,reader.onerror=function(){o("Error occured while parsing the uploaded file",k)},reader.onabort=function(){o("Operation aborted",k)},reader.onload=function(t){try{var a=JSON.parse(t.target.result);myDiagram.model=e.Model.fromJson(a),o("Project successfully loaded",S)}catch(n){o("Error occurred while parsing the uploaded file",k)}},reader.readAsText(t.target.files[0])}),jQuery("#save").click(function(){T({message:!0})}),jQuery("#makeSvg").click(function(){var e=window.open("","newWindow");if(e){var t=e.document,a=myDiagram.makeSvg({document:t,scale:1});t.body.appendChild(a)}}),jQuery("#load").click(function(){w({message:!0})}),jQuery("#distribute-vertically").on("click",function(){var e=_.chain(myDiagram.selection.toArray()).filter(function(e){return"SwimLane"!=e.category&&""!=e.category}).sortBy(function(e){return e.location.y}).value();if(e.length>2){myDiagram.startTransaction("distribute-vertically");var t=e[0].location.y,a=Math.max((e[e.length-1].location.y-e[0].location.y)/(e.length-1),x);_.each(e,function(e){myDiagram.model.setDataProperty(e.part.data,"loc",e.location.x.toString()+" "+t.toString()),t+=a}),c(),myDiagram.commitTransaction("distribute-vertically")}}),jQuery("#export-to-json").on("click",function(){n(new Blob([JSON.parse(JSON.stringify(myDiagram.model.toJson()))],{type:"text/json;charset=utf-8"}),projectTitle+".json")}),jQuery("#refresh").on("click",function(){myDiagram.isModified?T({message:!0,load:!0}):w({message:!0})}),f()})});